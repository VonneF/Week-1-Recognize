<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 1: Recognize | Healing with Yvonne</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #F8FAFA; 
            color: #334155;
        }
        .font-serif { font-family: 'Libre Baskerville', serif; }
        
        /* Print and PDF Generation Styles */
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; padding: 0 !important; }
            .print-block { 
                display: block !important; 
                margin-top: 0 !important; 
                border: 1px solid #e2e8f0 !important; 
                border-radius: 1rem !important; 
                padding: 2rem !important; 
                box-shadow: none !important;
                page-break-inside: avoid;
            }
            .container-box { box-shadow: none !important; border: none !important; width: 100% !important; max-width: 100% !important; padding: 0 !important; }
            textarea, input { border: none !important; background: transparent !important; resize: none !important; }
            .day-row { page-break-inside: avoid; border-bottom: 1px solid #eee; }
        }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- FIREBASE INITIALIZATION ---
        const initializeFirebase = () => {
            if (typeof firebase !== 'undefined' && typeof __firebase_config !== 'undefined') {
                try {
                    const config = JSON.parse(__firebase_config);
                    if (!firebase.apps.length) {
                        firebase.initializeApp(config);
                    }
                    return { auth: firebase.auth(), db: firebase.firestore() };
                } catch (e) {
                    console.error("Firebase config error:", e);
                }
            }
            return { auth: null, db: null };
        };

        const { auth, db } = initializeFirebase();
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'yvonne-week1-recognize';

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('intro'); // intro, scripts, exercises, audio, reflection
            const [loading, setLoading] = useState(true);

            // Workbook Data Structure
            const [workbook, setWorkbook] = useState({
                intentions: '',
                exercise1: { script: '', reasoning: '' },
                exercise2: Array.from({ length: 7 }, (_, i) => ({
                    day: i + 1,
                    wrong: { voice: '', body: '' },
                    compliment: { voice: '', body: '' },
                    decision: { voice: '', body: '' }
                })),
                exercise3: { tension: '', remindsMe: '' },
                audioReflections: { q1: '', q2: '', q3: '', q4: '', q5: '' }
            });

            useEffect(() => {
                if (auth) {
                    const unsubscribe = auth.onAuthStateChanged(async (u) => {
                        if (!u) {
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                await auth.signInWithCustomToken(__initial_auth_token);
                            } else {
                                await auth.signInAnonymously();
                            }
                        } else {
                            setUser(u);
                            loadData(u.uid);
                        }
                    });
                    return () => unsubscribe();
                }
            }, []);

            const loadData = async (uid) => {
                if (!db) { setLoading(false); return; }
                try {
                    const docRef = db.collection('artifacts').doc(appId).collection('users').doc(uid);
                    const docSnap = await docRef.get();
                    if (docSnap.exists) { setWorkbook(docSnap.data()); }
                } catch (e) { console.error("Load error:", e); }
                finally { setLoading(false); }
            };

            const saveData = async (newData) => {
                if (!user || !db) return;
                try {
                    await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).set(newData);
                } catch (e) { console.error("Save error:", e); }
            };

            const updateData = (path, value) => {
                const keys = path.split('.');
                const next = { ...workbook };
                let current = next;
                for (let i = 0; i < keys.length - 1; i++) {
                    current = current[keys[i]];
                }
                current[keys[keys.length - 1]] = value;
                setWorkbook(next);
                saveData(next);
            };

            const updateAudit = (dayIdx, moment, field, val) => {
                const next = { ...workbook };
                next.exercise2[dayIdx][moment][field] = val;
                setWorkbook(next);
                saveData(next);
            };

            const handleDownload = () => {
                window.print();
            };

            if (loading) return (
                <div className="min-h-screen flex items-center justify-center text-slate-400 text-xs tracking-widest uppercase italic">
                    Opening Workbook...
                </div>
            );

            return (
                <div className="min-h-screen pb-24">
                    <div className="max-w-4xl mx-auto p-4 sm:p-8 container-box">
                        
                        {/* Header Branding */}
                        <div className="text-center mb-10 no-print">
                            <p className="text-[10px] font-bold tracking-[0.4em] uppercase text-teal-700 mb-2">Healing with Yvonne</p>
                            <h1 className="text-3xl font-serif italic text-slate-900 leading-tight">Week 1: Recognize</h1>
                            <p className="text-sm text-slate-400 mt-2 italic">"You cannot change what you cannot see. This week, we simply look."</p>
                        </div>

                        <div className="bg-white rounded-[2rem] shadow-2xl p-8 sm:p-14 border border-slate-100 min-h-[600px] flex flex-col fade-in">
                            
                            {/* VIEW: INTRO & INTENTION */}
                            {view === 'intro' && (
                                <div className="space-y-8">
                                    <div className="space-y-4">
                                        <h2 className="text-2xl font-serif italic text-slate-800">What Is Scarcity Thinking?</h2>
                                        <p className="text-slate-600 text-sm leading-relaxed">
                                            Scarcity thinking is the inner operating system that tells you there is never enough â€” not enough time, love, money, success, safety, or worth. 
                                            It's not your fault. This pattern was built by your nervous system as a protection mechanism.
                                        </p>
                                    </div>

                                    <div className="bg-teal-50/50 p-8 rounded-3xl border border-teal-100">
                                        <h3 className="text-xs font-bold text-teal-800 uppercase tracking-widest mb-4">Week 1 Intention Setting</h3>
                                        <textarea 
                                            className="w-full bg-white border border-teal-100 p-4 rounded-xl text-sm outline-none focus:ring-2 focus:ring-teal-200 min-h-[100px]"
                                            placeholder="This week, I am simply willing to notice... I commit to observing without judgment when..."
                                            value={workbook.intentions}
                                            onChange={e => updateData('intentions', e.target.value)}
                                        />
                                    </div>

                                    <button onClick={() => setView('scripts')} className="w-full bg-slate-900 text-white font-bold py-5 rounded-2xl shadow-xl hover:bg-slate-800 transition-all flex items-center justify-center gap-2">
                                        Identify Core Scripts
                                        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
                                    </button>
                                </div>
                            )}

                            {/* VIEW: CORE SCRIPTS */}
                            {view === 'scripts' && (
                                <div className="space-y-8">
                                    <h2 className="text-2xl font-serif italic text-slate-800">The 3 Core Scarcity Scripts</h2>
                                    
                                    <div className="grid grid-cols-1 gap-4">
                                        {[
                                            { id: 'lack', t: 'Script 1: The Lack Loop', q: '"There\'s never enough." / "I can\'t afford to..."', d: 'Scans for what is missing. Hypervigilant to loss and blind to what is present.' },
                                            { id: 'unworthy', t: 'Script 2: The Unworthiness Whisper', q: '"Who am I to want this?" / "I don\'t deserve good things."', d: 'Contracts you before you even take action. Teaches you to shrink as safety.' },
                                            { id: 'bracing', t: 'Script 3: The Bracing Stance', q: '"Something will go wrong." / "I shouldn\'t get too excited."', d: 'Keeps your nervous system in low-grade fight-or-flight, preparing for impact that never comes.' }
                                        ].map(s => (
                                            <div key={s.id} onClick={() => updateData('exercise1.script', s.id)} className={`p-6 rounded-3xl border-2 transition-all cursor-pointer ${workbook.exercise1.script === s.id ? 'border-teal-500 bg-teal-50/30' : 'border-slate-50 bg-slate-50/50 hover:border-teal-200'}`}>
                                                <h4 className="font-bold text-slate-800 text-sm mb-1">{s.t}</h4>
                                                <p className="text-teal-700 italic text-xs mb-3">{s.q}</p>
                                                <p className="text-slate-500 text-xs leading-relaxed">{s.d}</p>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="space-y-3">
                                        <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Exercise 1: Why does this script resonate?</label>
                                        <textarea 
                                            className="w-full bg-slate-50 border border-slate-100 p-4 rounded-xl text-sm outline-none focus:ring-2 focus:ring-teal-100 min-h-[100px]"
                                            placeholder="The script I recognize most in myself is... because..."
                                            value={workbook.exercise1.reasoning}
                                            onChange={e => updateData('exercise1.reasoning', e.target.value)}
                                        />
                                    </div>

                                    <div className="flex gap-4">
                                        <button onClick={() => setView('intro')} className="px-6 py-4 text-slate-400 hover:text-slate-800 font-bold uppercase text-[10px] tracking-widest">Back</button>
                                        <button onClick={() => setView('exercises')} className="flex-1 bg-slate-900 text-white font-bold py-5 rounded-2xl shadow-xl">Continue to Daily Audit</button>
                                    </div>
                                </div>
                            )}

                            {/* VIEW: EXERCISES (7-Day Audit) */}
                            {view === 'exercises' && (
                                <div className="space-y-10">
                                    <div className="space-y-4">
                                        <h2 className="text-2xl font-serif italic text-slate-800">Exercise 2: The Inner Critic Audit</h2>
                                        <p className="text-slate-500 text-xs leading-relaxed italic mb-6">Track your self-talk for the next 7 days in these specific moments.</p>
                                        
                                        <div className="space-y-8 max-h-[500px] overflow-y-auto pr-2">
                                            {workbook.exercise2.map((day, dIdx) => (
                                                <div key={day.day} className="p-6 bg-slate-50/50 rounded-[2rem] border border-slate-100 space-y-4 day-row">
                                                    <h4 className="text-xs font-bold text-teal-800 uppercase tracking-widest border-b border-teal-100 pb-2">Day {day.day}</h4>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        {['wrong', 'compliment', 'decision'].map(moment => (
                                                            <div key={moment} className="space-y-2">
                                                                <p className="text-[10px] font-bold text-slate-400 uppercase">
                                                                    {moment === 'wrong' ? 'Something went wrong' : moment === 'compliment' ? 'Received a compliment' : 'Making a decision'}
                                                                </p>
                                                                <input 
                                                                    className="w-full bg-white border border-slate-100 p-3 rounded-xl text-xs italic outline-none focus:ring-1 focus:ring-teal-100"
                                                                    placeholder="Voice said..."
                                                                    value={workbook.exercise2[dIdx][moment].voice}
                                                                    onChange={e => updateAudit(dIdx, moment, 'voice', e.target.value)}
                                                                />
                                                                <input 
                                                                    className="w-full bg-white border border-slate-100 p-3 rounded-xl text-[10px] outline-none focus:ring-1 focus:ring-teal-100"
                                                                    placeholder="Body felt..."
                                                                    value={workbook.exercise2[dIdx][moment].body}
                                                                    onChange={e => updateAudit(dIdx, moment, 'body', e.target.value)}
                                                                />
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="space-y-6 pt-8 border-t border-slate-100">
                                        <h2 className="text-2xl font-serif italic text-slate-800">Exercise 3: Body-Based Scarcity Check-In</h2>
                                        <div className="bg-slate-900 text-white p-8 rounded-3xl space-y-4 shadow-xl">
                                            <p className="text-sm leading-relaxed italic">"Where does 'not enough' live in me right now?"</p>
                                            <div className="space-y-4 pt-4">
                                                <input 
                                                    className="w-full bg-slate-800 border-none p-4 rounded-xl text-sm text-white outline-none focus:ring-1 focus:ring-teal-500 placeholder:text-slate-600"
                                                    placeholder="I notice tension / tightness / heaviness in..."
                                                    value={workbook.exercise3.tension}
                                                    onChange={e => updateData('exercise3.tension', e.target.value)}
                                                />
                                                <input 
                                                    className="w-full bg-slate-800 border-none p-4 rounded-xl text-sm text-white outline-none focus:ring-1 focus:ring-teal-500 placeholder:text-slate-600"
                                                    placeholder="It reminds me of..."
                                                    value={workbook.exercise3.remindsMe}
                                                    onChange={e => updateData('exercise3.remindsMe', e.target.value)}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex gap-4">
                                        <button onClick={() => setView('scripts')} className="px-6 py-4 text-slate-400 font-bold uppercase text-[10px] tracking-widest">Back</button>
                                        <button onClick={() => setView('audio')} className="flex-1 bg-slate-900 text-white font-bold py-5 rounded-2xl shadow-xl">Go to Audio Practice</button>
                                    </div>
                                </div>
                            )}

                            {/* VIEW: AUDIO PRACTICE */}
                            {view === 'audio' && (
                                <div className="space-y-8 flex flex-col flex-1">
                                    <div className="text-center space-y-4">
                                        <h2 className="text-2xl font-serif italic text-slate-800">"The Observer" Practice</h2>
                                        <p className="text-slate-400 text-[10px] uppercase tracking-[0.2em] font-bold">Scarcity Awareness Practice</p>
                                    </div>

                                    <div className="bg-teal-950 p-10 rounded-[3rem] shadow-2xl flex flex-col items-center text-center space-y-8">
                                        <div className="w-20 h-20 bg-teal-900 rounded-full flex items-center justify-center text-teal-300">
                                            <svg className="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" /></svg>
                                        </div>
                                        
                                        <audio controls className="w-full max-w-sm filter brightness-110 contrast-125">
                                            <source src="ElevenLabs_Week 1 Recognize script.mp3" type="audio/mpeg" />
                                            Your browser does not support audio playback.
                                        </audio>
                                        
                                        <div className="space-y-2">
                                            <h4 className="text-teal-50 font-serif italic text-lg">Observe. Not Fix. Just See.</h4>
                                        </div>
                                    </div>

                                    <div className="bg-slate-50 p-8 rounded-3xl border border-slate-100 space-y-4">
                                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Somatic Anchor</p>
                                        <p className="text-sm text-slate-600 leading-relaxed italic">
                                            "Place one hand on your chest. Feel the warmth of your own touch... turn down the volume on the inner critic."
                                        </p>
                                    </div>

                                    <button onClick={() => setView('reflection')} className="mt-auto w-full bg-slate-900 text-white font-bold py-5 rounded-2xl shadow-xl">Go to Reflection Questions</button>
                                </div>
                            )}

                            {/* VIEW: FINAL REFLECTION & EXPORT */}
                            {view === 'reflection' && (
                                <div className="space-y-8">
                                    <h2 className="text-2xl font-serif italic text-slate-800">Integration Reflection</h2>
                                    
                                    <div className="space-y-10">
                                        {[
                                            { id: 'q1', q: '1. What was the first thought your inner voice offered when you brought up your uncertain situation?' },
                                            { id: 'q2', q: '2. When you placed your hand on your chest, what did you notice in your body?' },
                                            { id: 'q3', q: '3. What scarcity script do you think was running during this practice?' },
                                            { id: 'q4', q: '4. What would it mean for you to trust the Observer?' },
                                            { id: 'q5', q: '5. What is one small thing you are choosing to notice this week?' }
                                        ].map(item => (
                                            <div key={item.id} className="space-y-3">
                                                <label className="text-sm font-semibold text-slate-700 leading-relaxed block">{item.q}</label>
                                                <textarea 
                                                    className="w-full bg-slate-50 border border-slate-200 p-5 rounded-2xl text-sm outline-none focus:ring-2 focus:ring-teal-100 shadow-inner"
                                                    value={workbook.audioReflections[item.id]}
                                                    onChange={e => updateData(`audioReflections.${item.id}`, e.target.value)}
                                                    rows="3"
                                                />
                                            </div>
                                        ))}
                                    </div>

                                    <div className="p-10 bg-slate-900 text-white rounded-[3rem] text-center space-y-6 shadow-2xl">
                                        <h3 className="text-3xl font-serif italic">Recognition is Step One.</h3>
                                        <p className="text-slate-400 text-sm leading-relaxed max-w-md mx-auto">
                                            Repetition creates rewiring. Save your workbook to see your progress at the end of the month.
                                        </p>
                                        <button 
                                            onClick={handleDownload} 
                                            className="bg-teal-500 text-white px-10 py-5 rounded-2xl font-bold uppercase tracking-widest text-[10px] hover:bg-teal-400 transition-all flex items-center justify-center gap-2 mx-auto"
                                        >
                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                                            Download Completed Workbook
                                        </button>
                                    </div>
                                </div>
                            )}

                        </div>

                        {/* Persistent Bottom Navigation */}
                        <div className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 no-print z-50">
                            <div className="max-w-md mx-auto flex justify-between px-2">
                                <button onClick={() => setView('intro')} className={`flex flex-col items-center gap-1 transition-all ${view === 'intro' ? 'text-teal-700 scale-110' : 'text-stone-300'}`}>
                                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                                    <span className="text-[8px] font-bold uppercase tracking-widest">Start</span>
                                </button>
                                <button onClick={() => setView('scripts')} className={`flex flex-col items-center gap-1 transition-all ${view === 'scripts' ? 'text-teal-700 scale-110' : 'text-stone-300'}`}>
                                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                                    <span className="text-[8px] font-bold uppercase tracking-widest">Scripts</span>
                                </button>
                                <button onClick={() => setView('exercises')} className={`flex flex-col items-center gap-1 transition-all ${view === 'exercises' ? 'text-teal-700 scale-110' : 'text-stone-300'}`}>
                                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>
                                    <span className="text-[8px] font-bold uppercase tracking-widest">Audit</span>
                                </button>
                                <button onClick={() => setView('audio')} className={`flex flex-col items-center gap-1 transition-all ${view === 'audio' ? 'text-teal-700 scale-110' : 'text-stone-300'}`}>
                                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                                    <span className="text-[8px] font-bold uppercase tracking-widest">Audio</span>
                                </button>
                                <button onClick={() => setView('reflection')} className={`flex flex-col items-center gap-1 transition-all ${view === 'reflection' ? 'text-teal-700 scale-110' : 'text-stone-300'}`}>
                                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" /></svg>
                                    <span className="text-[8px] font-bold uppercase tracking-widest">Finish</span>
                                </button>
                            </div>
                        </div>

                        <div className="mt-12 text-center pb-8 no-print">
                            <p className="text-slate-300 text-[10px] tracking-[0.4em] uppercase font-bold">&copy; 2025 Healing with Yvonne</p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
